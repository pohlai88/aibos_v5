<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-BOS Accounting - Audit Trail</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'apple-blue': '#007AFF',
                        'apple-green': '#34C759',
                        'apple-orange': '#FF9500',
                        'apple-red': '#FF3B30',
                        'apple-gray': '#8E8E93',
                        'apple-bg': '#F2F2F7',
                        'apple-card': '#FFFFFF',
                        'apple-border': '#E5E5EA'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-apple-bg min-h-screen">
    <!-- Navigation -->
    <nav class="bg-apple-card border-b border-apple-border shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <h1 class="text-2xl font-bold text-apple-blue">AI-BOS</h1>
                    </div>
                    <div class="hidden md:block ml-10">
                        <div class="flex items-baseline space-x-4">
                            <a href="index.html" class="text-gray-500 hover:text-apple-blue px-3 py-2 text-sm font-medium">Dashboard</a>
                            <a href="accounts.html" class="text-gray-500 hover:text-apple-blue px-3 py-2 text-sm font-medium">Chart of Accounts</a>
                            <a href="transactions.html" class="text-gray-500 hover:text-apple-blue px-3 py-2 text-sm font-medium">General Ledger</a>
                            <a href="ap-ar.html" class="text-gray-500 hover:text-apple-blue px-3 py-2 text-sm font-medium">AP/AR</a>
                            <a href="banking.html" class="text-gray-500 hover:text-apple-blue px-3 py-2 text-sm font-medium">Banking</a>
                            <a href="tax.html" class="text-gray-500 hover:text-apple-blue px-3 py-2 text-sm font-medium">Tax</a>
                            <a href="reports.html" class="text-gray-500 hover:text-apple-blue px-3 py-2 text-sm font-medium">Reports</a>
                            <a href="#" class="text-apple-blue border-b-2 border-apple-blue px-3 py-2 text-sm font-medium">Audit Trail</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Page Header -->
        <div class="mb-8">
            <div class="flex items-center justify-between">
                <div>
                    <h2 class="text-3xl font-bold text-gray-900">Audit Trail</h2>
                    <p class="text-gray-600 mt-2">Immutable logs and change tracking for compliance</p>
                </div>
                <div class="flex space-x-3">
                    <button id="exportAuditBtn" class="px-4 py-2 border border-apple-border text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                        <i class="fas fa-download mr-2"></i>Export Logs
                    </button>
                    <button id="generateComplianceBtn" class="px-4 py-2 bg-apple-blue text-white rounded-lg hover:bg-blue-600 transition-colors">
                        <i class="fas fa-shield-alt mr-2"></i>Compliance Report
                    </button>
                </div>
            </div>
        </div>

        <!-- Audit Summary Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <!-- Total Changes -->
            <div class="bg-apple-card rounded-xl shadow-sm border border-apple-border p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Total Changes</p>
                        <p id="totalChanges" class="text-2xl font-bold text-gray-900">1,247</p>
                        <p class="text-sm text-apple-blue mt-1">
                            <i class="fas fa-chart-line mr-1"></i>+12 this week
                        </p>
                    </div>
                    <div class="h-12 w-12 bg-apple-blue/10 rounded-lg flex items-center justify-center">
                        <i class="fas fa-history text-apple-blue text-xl"></i>
                    </div>
                </div>
            </div>

            <!-- Users Active -->
            <div class="bg-apple-card rounded-xl shadow-sm border border-apple-border p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Active Users</p>
                        <p id="activeUsers" class="text-2xl font-bold text-gray-900">3</p>
                        <p class="text-sm text-apple-green mt-1">
                            <i class="fas fa-users mr-1"></i>This month
                        </p>
                    </div>
                    <div class="h-12 w-12 bg-apple-green/10 rounded-lg flex items-center justify-center">
                        <i class="fas fa-user-check text-apple-green text-xl"></i>
                    </div>
                </div>
            </div>

            <!-- Critical Changes -->
            <div class="bg-apple-card rounded-xl shadow-sm border border-apple-border p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Critical Changes</p>
                        <p id="criticalChanges" class="text-2xl font-bold text-apple-red">5</p>
                        <p class="text-sm text-apple-red mt-1">
                            <i class="fas fa-exclamation-triangle mr-1"></i>Requires review
                        </p>
                    </div>
                    <div class="h-12 w-12 bg-apple-red/10 rounded-lg flex items-center justify-center">
                        <i class="fas fa-exclamation-circle text-apple-red text-xl"></i>
                    </div>
                </div>
            </div>

            <!-- Data Integrity -->
            <div class="bg-apple-card rounded-xl shadow-sm border border-apple-border p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Data Integrity</p>
                        <p id="dataIntegrity" class="text-2xl font-bold text-apple-green">100%</p>
                        <p class="text-sm text-apple-green mt-1">
                            <i class="fas fa-shield-check mr-1"></i>All checks passed
                        </p>
                    </div>
                    <div class="h-12 w-12 bg-apple-green/10 rounded-lg flex items-center justify-center">
                        <i class="fas fa-shield-alt text-apple-green text-xl"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Audit Filters -->
        <div class="bg-apple-card rounded-xl shadow-sm border border-apple-border p-6 mb-6">
            <div class="flex flex-wrap items-center gap-4">
                <div class="flex items-center space-x-2">
                    <label class="text-sm font-medium text-gray-700">Action Type:</label>
                    <select id="actionTypeFilter" class="px-3 py-2 border border-apple-border rounded-lg text-sm">
                        <option value="">All Actions</option>
                        <option value="create">Create</option>
                        <option value="update">Update</option>
                        <option value="delete">Delete</option>
                        <option value="login">Login</option>
                        <option value="export">Export</option>
                    </select>
                </div>
                <div class="flex items-center space-x-2">
                    <label class="text-sm font-medium text-gray-700">User:</label>
                    <select id="userFilter" class="px-3 py-2 border border-apple-border rounded-lg text-sm">
                        <option value="">All Users</option>
                        <option value="admin">Admin User</option>
                        <option value="accountant">Accountant</option>
                        <option value="viewer">Viewer</option>
                    </select>
                </div>
                <div class="flex items-center space-x-2">
                    <label class="text-sm font-medium text-gray-700">Date Range:</label>
                    <input type="date" id="startDate" class="px-3 py-2 border border-apple-border rounded-lg text-sm">
                    <span class="text-gray-500">to</span>
                    <input type="date" id="endDate" class="px-3 py-2 border border-apple-border rounded-lg text-sm">
                </div>
                <div class="flex items-center space-x-2">
                    <input type="text" id="searchAudit" placeholder="Search audit logs..." class="px-3 py-2 border border-apple-border rounded-lg text-sm w-64">
                    <i class="fas fa-search text-gray-400"></i>
                </div>
                <button id="clearFiltersBtn" class="px-4 py-2 border border-apple-border text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                    Clear Filters
                </button>
            </div>
        </div>

        <!-- Audit Timeline -->
        <div class="bg-apple-card rounded-xl shadow-sm border border-apple-border p-6 mb-8">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-semibold text-gray-900">Audit Timeline</h3>
                <div class="flex space-x-2">
                    <button id="realTimeBtn" class="px-3 py-1 text-xs bg-apple-blue text-white rounded-lg">Real-time</button>
                    <button id="historicalBtn" class="px-3 py-1 text-xs bg-gray-200 text-gray-700 rounded-lg">Historical</button>
                </div>
            </div>
            <div class="space-y-4 max-h-96 overflow-y-auto">
                <!-- Audit Entry 1 -->
                <div class="flex items-start space-x-4 p-4 bg-gray-50 rounded-lg">
                    <div class="flex-shrink-0">
                        <div class="h-8 w-8 bg-apple-green/10 rounded-lg flex items-center justify-center">
                            <i class="fas fa-plus text-apple-green text-sm"></i>
                        </div>
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center justify-between">
                            <p class="text-sm font-medium text-gray-900">Transaction Created</p>
                            <p class="text-xs text-gray-500">2 minutes ago</p>
                        </div>
                        <p class="text-sm text-gray-600 mt-1">New journal entry #000006 created by Admin User</p>
                        <div class="mt-2 text-xs text-gray-500">
                            <span class="font-medium">Details:</span> Debit: Cash ($1,000), Credit: Service Revenue ($1,000)
                        </div>
                        <div class="mt-2 flex items-center space-x-2">
                            <span class="px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full">Low Risk</span>
                            <span class="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full">Transaction</span>
                        </div>
                    </div>
                </div>

                <!-- Audit Entry 2 -->
                <div class="flex items-start space-x-4 p-4 bg-yellow-50 rounded-lg">
                    <div class="flex-shrink-0">
                        <div class="h-8 w-8 bg-apple-orange/10 rounded-lg flex items-center justify-center">
                            <i class="fas fa-edit text-apple-orange text-sm"></i>
                        </div>
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center justify-between">
                            <p class="text-sm font-medium text-gray-900">Account Updated</p>
                            <p class="text-xs text-gray-500">15 minutes ago</p>
                        </div>
                        <p class="text-sm text-gray-600 mt-1">Account "Office Supplies" modified by Accountant</p>
                        <div class="mt-2 text-xs text-gray-500">
                            <span class="font-medium">Changes:</span> Description updated from "Office supplies" to "Office supplies and materials"
                        </div>
                        <div class="mt-2 flex items-center space-x-2">
                            <span class="px-2 py-1 text-xs bg-yellow-100 text-yellow-800 rounded-full">Medium Risk</span>
                            <span class="px-2 py-1 text-xs bg-orange-100 text-orange-800 rounded-full">Account</span>
                        </div>
                    </div>
                </div>

                <!-- Audit Entry 3 -->
                <div class="flex items-start space-x-4 p-4 bg-red-50 rounded-lg">
                    <div class="flex-shrink-0">
                        <div class="h-8 w-8 bg-apple-red/10 rounded-lg flex items-center justify-center">
                            <i class="fas fa-trash text-apple-red text-sm"></i>
                        </div>
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center justify-between">
                            <p class="text-sm font-medium text-gray-900">Transaction Deleted</p>
                            <p class="text-xs text-gray-500">1 hour ago</p>
                        </div>
                        <p class="text-sm text-gray-600 mt-1">Transaction #000005 deleted by Admin User</p>
                        <div class="mt-2 text-xs text-gray-500">
                            <span class="font-medium">Reason:</span> Duplicate entry - original amount was $4,000
                        </div>
                        <div class="mt-2 flex items-center space-x-2">
                            <span class="px-2 py-1 text-xs bg-red-100 text-red-800 rounded-full">High Risk</span>
                            <span class="px-2 py-1 text-xs bg-red-100 text-red-800 rounded-full">Deletion</span>
                        </div>
                    </div>
                </div>

                <!-- Audit Entry 4 -->
                <div class="flex items-start space-x-4 p-4 bg-blue-50 rounded-lg">
                    <div class="flex-shrink-0">
                        <div class="h-8 w-8 bg-apple-blue/10 rounded-lg flex items-center justify-center">
                            <i class="fas fa-download text-apple-blue text-sm"></i>
                        </div>
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center justify-between">
                            <p class="text-sm font-medium text-gray-900">Data Export</p>
                            <p class="text-xs text-gray-500">2 hours ago</p>
                        </div>
                        <p class="text-sm text-gray-600 mt-1">Financial report exported by Admin User</p>
                        <div class="mt-2 text-xs text-gray-500">
                            <span class="font-medium">File:</span> financial_report_q4_2024.pdf (2.3 MB)
                        </div>
                        <div class="mt-2 flex items-center space-x-2">
                            <span class="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full">Low Risk</span>
                            <span class="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full">Export</span>
                        </div>
                    </div>
                </div>

                <!-- Audit Entry 5 -->
                <div class="flex items-start space-x-4 p-4 bg-gray-50 rounded-lg">
                    <div class="flex-shrink-0">
                        <div class="h-8 w-8 bg-apple-green/10 rounded-lg flex items-center justify-center">
                            <i class="fas fa-sign-in-alt text-apple-green text-sm"></i>
                        </div>
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center justify-between">
                            <p class="text-sm font-medium text-gray-900">User Login</p>
                            <p class="text-xs text-gray-500">3 hours ago</p>
                        </div>
                        <p class="text-sm text-gray-600 mt-1">Accountant logged in from 192.168.1.100</p>
                        <div class="mt-2 text-xs text-gray-500">
                            <span class="font-medium">Session:</span> 45 minutes duration
                        </div>
                        <div class="mt-2 flex items-center space-x-2">
                            <span class="px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full">Low Risk</span>
                            <span class="px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full">Authentication</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Change Tracking -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- Before/After Comparison -->
            <div class="bg-apple-card rounded-xl shadow-sm border border-apple-border p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-900">Change Comparison</h3>
                    <button id="viewDiffBtn" class="text-apple-blue text-sm font-medium hover:text-blue-600">
                        View Diff
                    </button>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <h4 class="text-sm font-medium text-gray-700 mb-3">Before</h4>
                        <div class="bg-gray-50 p-3 rounded-lg text-sm">
                            <div class="mb-2">
                                <span class="font-medium">Account:</span> Office Supplies
                            </div>
                            <div class="mb-2">
                                <span class="font-medium">Description:</span> Office supplies
                            </div>
                            <div class="mb-2">
                                <span class="font-medium">Balance:</span> $2,000.00
                            </div>
                            <div>
                                <span class="font-medium">Status:</span> Active
                            </div>
                        </div>
                    </div>
                    <div>
                        <h4 class="text-sm font-medium text-gray-700 mb-3">After</h4>
                        <div class="bg-green-50 p-3 rounded-lg text-sm">
                            <div class="mb-2">
                                <span class="font-medium">Account:</span> Office Supplies
                            </div>
                            <div class="mb-2">
                                <span class="font-medium">Description:</span> Office supplies and materials
                            </div>
                            <div class="mb-2">
                                <span class="font-medium">Balance:</span> $2,000.00
                            </div>
                            <div>
                                <span class="font-medium">Status:</span> Active
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-4 p-3 bg-yellow-50 rounded-lg">
                    <p class="text-xs text-gray-600">
                        <span class="font-medium">Change Summary:</span> Description field updated from "Office supplies" to "Office supplies and materials"
                    </p>
                </div>
            </div>

            <!-- User Activity -->
            <div class="bg-apple-card rounded-xl shadow-sm border border-apple-border p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-900">User Activity</h3>
                    <button id="viewAllActivityBtn" class="text-apple-blue text-sm font-medium hover:text-blue-600">
                        View All
                    </button>
                </div>
                <div class="space-y-3">
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div class="flex items-center">
                            <div class="h-8 w-8 bg-apple-blue text-white rounded-lg flex items-center justify-center text-sm font-medium">
                                A
                            </div>
                            <div class="ml-3">
                                <p class="text-sm font-medium">Admin User</p>
                                <p class="text-xs text-gray-600">Last active: 2 minutes ago</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-sm font-medium text-gray-900">15 actions</p>
                            <p class="text-xs text-gray-600">Today</p>
                        </div>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div class="flex items-center">
                            <div class="h-8 w-8 bg-apple-green text-white rounded-lg flex items-center justify-center text-sm font-medium">
                                AC
                            </div>
                            <div class="ml-3">
                                <p class="text-sm font-medium">Accountant</p>
                                <p class="text-xs text-gray-600">Last active: 3 hours ago</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-sm font-medium text-gray-900">8 actions</p>
                            <p class="text-xs text-gray-600">Today</p>
                        </div>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div class="flex items-center">
                            <div class="h-8 w-8 bg-apple-orange text-white rounded-lg flex items-center justify-center text-sm font-medium">
                                V
                            </div>
                            <div class="ml-3">
                                <p class="text-sm font-medium">Viewer</p>
                                <p class="text-xs text-gray-600">Last active: 1 day ago</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-sm font-medium text-gray-900">3 actions</p>
                            <p class="text-xs text-gray-600">Today</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Compliance Reporting -->
        <div class="bg-apple-card rounded-xl shadow-sm border border-apple-border p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-semibold text-gray-900">Compliance & Security</h3>
                <button id="generateComplianceReportBtn" class="px-4 py-2 bg-apple-green text-white rounded-lg hover:bg-green-600 transition-colors">
                    <i class="fas fa-file-alt mr-2"></i>Generate Report
                </button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <h4 class="text-sm font-medium text-gray-700 mb-3">Data Retention</h4>
                    <div class="space-y-2">
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Audit Logs</span>
                            <span class="text-sm font-medium">7 years</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Financial Records</span>
                            <span class="text-sm font-medium">7 years</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">User Sessions</span>
                            <span class="text-sm font-medium">2 years</span>
                        </div>
                    </div>
                </div>
                <div>
                    <h4 class="text-sm font-medium text-gray-700 mb-3">Access Controls</h4>
                    <div class="space-y-2">
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Role-based Access</span>
                            <span class="px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full">Enabled</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Two-factor Auth</span>
                            <span class="px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full">Enabled</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Session Timeout</span>
                            <span class="text-sm font-medium">30 minutes</span>
                        </div>
                    </div>
                </div>
                <div>
                    <h4 class="text-sm font-medium text-gray-700 mb-3">Security Status</h4>
                    <div class="space-y-2">
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Data Encryption</span>
                            <span class="px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full">Active</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Backup Status</span>
                            <span class="px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full">Current</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">Vulnerability Scan</span>
                            <span class="px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full">Passed</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="database.js"></script>
    <script src="app.js"></script>
    <script>
        class AuditTrail {
            constructor() {
                this.auditLogs = [];
                this.init();
            }

            async init() {
                await this.loadData();
                this.setupEventListeners();
                this.renderData();
            }

            async loadData() {
                // Mock audit logs
                this.auditLogs = [
                    {
                        id: 1,
                        action: 'create',
                        entity: 'transaction',
                        description: 'New journal entry #000006 created',
                        user: 'Admin User',
                        timestamp: new Date(Date.now() - 2 * 60 * 1000), // 2 minutes ago
                        risk: 'low',
                        details: {
                            debit: 'Cash ($1,000)',
                            credit: 'Service Revenue ($1,000)'
                        }
                    },
                    {
                        id: 2,
                        action: 'update',
                        entity: 'account',
                        description: 'Account "Office Supplies" modified',
                        user: 'Accountant',
                        timestamp: new Date(Date.now() - 15 * 60 * 1000), // 15 minutes ago
                        risk: 'medium',
                        details: {
                            field: 'description',
                            before: 'Office supplies',
                            after: 'Office supplies and materials'
                        }
                    },
                    {
                        id: 3,
                        action: 'delete',
                        entity: 'transaction',
                        description: 'Transaction #000005 deleted',
                        user: 'Admin User',
                        timestamp: new Date(Date.now() - 60 * 60 * 1000), // 1 hour ago
                        risk: 'high',
                        details: {
                            reason: 'Duplicate entry',
                            amount: '$4,000'
                        }
                    }
                ];
            }

            setupEventListeners() {
                document.getElementById('exportAuditBtn').addEventListener('click', () => this.exportAuditLogs());
                document.getElementById('generateComplianceBtn').addEventListener('click', () => this.generateComplianceReport());
                document.getElementById('clearFiltersBtn').addEventListener('click', () => this.clearFilters());
                
                // Filters
                document.getElementById('actionTypeFilter').addEventListener('change', () => this.filterLogs());
                document.getElementById('userFilter').addEventListener('change', () => this.filterLogs());
                document.getElementById('searchAudit').addEventListener('input', () => this.filterLogs());
            }

            renderData() {
                this.updateSummaryCards();
                this.renderAuditTimeline();
            }

            updateSummaryCards() {
                document.getElementById('totalChanges').textContent = this.auditLogs.length;
                document.getElementById('activeUsers').textContent = '3';
                document.getElementById('criticalChanges').textContent = this.auditLogs.filter(log => log.risk === 'high').length;
                document.getElementById('dataIntegrity').textContent = '100%';
            }

            renderAuditTimeline() {
                // Audit timeline is rendered in the HTML template
            }

            filterLogs() {
                const actionType = document.getElementById('actionTypeFilter').value;
                const user = document.getElementById('userFilter').value;
                const searchTerm = document.getElementById('searchAudit').value.toLowerCase();

                const filtered = this.auditLogs.filter(log => {
                    const matchesAction = !actionType || log.action === actionType;
                    const matchesUser = !user || log.user.toLowerCase().includes(user.toLowerCase());
                    const matchesSearch = !searchTerm || 
                        log.description.toLowerCase().includes(searchTerm) ||
                        log.entity.toLowerCase().includes(searchTerm);

                    return matchesAction && matchesUser && matchesSearch;
                });

                // Update the display based on filtered results
                console.log('Filtered logs:', filtered);
            }

            clearFilters() {
                document.getElementById('actionTypeFilter').value = '';
                document.getElementById('userFilter').value = '';
                document.getElementById('searchAudit').value = '';
                document.getElementById('startDate').value = '';
                document.getElementById('endDate').value = '';
                this.filterLogs();
            }

            exportAuditLogs() {
                const csv = this.convertToCSV(this.auditLogs);
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `audit_logs_${new Date().toISOString().split('T')[0]}.csv`;
                a.click();
            }

            generateComplianceReport() {
                alert('Generating compliance report...');
                // This would generate a comprehensive compliance report
                setTimeout(() => {
                    alert('Compliance report generated successfully!');
                }, 3000);
            }

            convertToCSV(data) {
                const headers = ['Timestamp', 'Action', 'Entity', 'Description', 'User', 'Risk Level'];
                const rows = data.map(log => [
                    log.timestamp.toISOString(),
                    log.action,
                    log.entity,
                    log.description,
                    log.user,
                    log.risk
                ]);
                
                return [headers.join(','), ...rows.map(row => row.join(','))].join('\n');
            }

            formatTimestamp(timestamp) {
                return new Intl.DateTimeFormat('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                }).format(timestamp);
            }
        }

        // Initialize when page loads
        let auditTrail;
        document.addEventListener('DOMContentLoaded', function() {
            auditTrail = new AuditTrail();
        });
    </script>
</body>
</html> 