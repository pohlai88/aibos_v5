<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-BOS Accounting - AP/AR Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'apple-blue': '#007AFF',
                        'apple-green': '#34C759',
                        'apple-orange': '#FF9500',
                        'apple-red': '#FF3B30',
                        'apple-gray': '#8E8E93',
                        'apple-bg': '#F2F2F7',
                        'apple-card': '#FFFFFF',
                        'apple-border': '#E5E5EA'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-apple-bg min-h-screen">
    <!-- Navigation -->
    <nav class="bg-apple-card border-b border-apple-border shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <h1 class="text-2xl font-bold text-apple-blue">AI-BOS</h1>
                    </div>
                    <div class="hidden md:block ml-10">
                        <div class="flex items-baseline space-x-4">
                            <a href="index.html" class="text-gray-500 hover:text-apple-blue px-3 py-2 text-sm font-medium">Dashboard</a>
                            <a href="accounts.html" class="text-gray-500 hover:text-apple-blue px-3 py-2 text-sm font-medium">Chart of Accounts</a>
                            <a href="transactions.html" class="text-gray-500 hover:text-apple-blue px-3 py-2 text-sm font-medium">General Ledger</a>
                            <div class="flex items-center space-x-1">
                                <a href="#" class="text-apple-blue border-b-2 border-apple-blue px-3 py-2 text-sm font-medium">AP/AR</a>
                                <div class="relative">
                                    <button id="apArDropdownBtn" class="text-apple-blue hover:text-blue-600">
                                        <i class="fas fa-chevron-down text-xs"></i>
                                    </button>
                                    <div id="apArDropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg z-50">
                                        <div class="py-1">
                                            <a href="customers.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Customers</a>
                                            <a href="suppliers.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Suppliers</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <a href="organization.html" class="text-gray-500 hover:text-apple-blue px-3 py-2 text-sm font-medium">Organization</a>
                            <a href="users.html" class="text-gray-500 hover:text-apple-blue px-3 py-2 text-sm font-medium">Users</a>
                            <a href="banking.html" class="text-gray-500 hover:text-apple-blue px-3 py-2 text-sm font-medium">Banking</a>
                            <a href="tax.html" class="text-gray-500 hover:text-apple-blue px-3 py-2 text-sm font-medium">Tax</a>
                            <a href="reports.html" class="text-gray-500 hover:text-apple-blue px-3 py-2 text-sm font-medium">Reports</a>
                            <a href="audit.html" class="text-gray-500 hover:text-apple-blue px-3 py-2 text-sm font-medium">Audit Trail</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Page Header -->
        <div class="mb-8">
            <div class="flex items-center justify-between">
                <div>
                    <h2 class="text-3xl font-bold text-gray-900">Accounts Payable & Receivable</h2>
                    <p class="text-gray-600 mt-2">Manage invoices, payments, and automated reminders</p>
                </div>
                <div class="flex space-x-3">
                    <button id="createInvoiceBtn" class="px-4 py-2 bg-apple-green text-white rounded-lg hover:bg-green-600 transition-colors">
                        <i class="fas fa-file-invoice mr-2"></i>Create Invoice
                    </button>
                    <button id="recordPaymentBtn" class="px-4 py-2 bg-apple-blue text-white rounded-lg hover:bg-blue-600 transition-colors">
                        <i class="fas fa-receipt mr-2"></i>Record Payment
                    </button>
                </div>
            </div>
        </div>

        <!-- AP/AR Summary Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <!-- Accounts Receivable -->
            <div class="bg-apple-card rounded-xl shadow-sm border border-apple-border p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Total Receivables</p>
                        <p id="totalReceivables" class="text-2xl font-bold text-gray-900">$15,000</p>
                        <p class="text-sm text-apple-orange mt-1">
                            <i class="fas fa-clock mr-1"></i>5 overdue
                        </p>
                    </div>
                    <div class="h-12 w-12 bg-apple-green/10 rounded-lg flex items-center justify-center">
                        <i class="fas fa-hand-holding-usd text-apple-green text-xl"></i>
                    </div>
                </div>
            </div>

            <!-- Accounts Payable -->
            <div class="bg-apple-card rounded-xl shadow-sm border border-apple-border p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Total Payables</p>
                        <p id="totalPayables" class="text-2xl font-bold text-gray-900">$25,000</p>
                        <p class="text-sm text-apple-red mt-1">
                            <i class="fas fa-exclamation-circle mr-1"></i>3 due this week
                        </p>
                    </div>
                    <div class="h-12 w-12 bg-apple-red/10 rounded-lg flex items-center justify-center">
                        <i class="fas fa-credit-card text-apple-red text-xl"></i>
                    </div>
                </div>
            </div>

            <!-- Aging Summary -->
            <div class="bg-apple-card rounded-xl shadow-sm border border-apple-border p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">30+ Days Past Due</p>
                        <p id="pastDueAmount" class="text-2xl font-bold text-apple-red">$3,500</p>
                        <p class="text-sm text-gray-600 mt-1">
                            <i class="fas fa-chart-line mr-1"></i>2 invoices
                        </p>
                    </div>
                    <div class="h-12 w-12 bg-apple-orange/10 rounded-lg flex items-center justify-center">
                        <i class="fas fa-calendar-times text-apple-orange text-xl"></i>
                    </div>
                </div>
            </div>

            <!-- Cash Flow Impact -->
            <div class="bg-apple-card rounded-xl shadow-sm border border-apple-border p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">Net Cash Flow</p>
                        <p id="netCashFlow" class="text-2xl font-bold text-apple-blue">-$10,000</p>
                        <p class="text-sm text-gray-600 mt-1">
                            <i class="fas fa-arrow-down mr-1"></i>This month
                        </p>
                    </div>
                    <div class="h-12 w-12 bg-apple-blue/10 rounded-lg flex items-center justify-center">
                        <i class="fas fa-chart-pie text-apple-blue text-xl"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="mb-6">
            <div class="border-b border-apple-border">
                <nav class="-mb-px flex space-x-8">
                    <button id="arTab" class="border-apple-blue text-apple-blue whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">
                        Accounts Receivable
                    </button>
                    <button id="apTab" class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">
                        Accounts Payable
                    </button>
                    <button id="agingTab" class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">
                        Aging Report
                    </button>
                </nav>
            </div>
        </div>

        <!-- AR Content -->
        <div id="arContent" class="space-y-6">
            <!-- AR Filters -->
            <div class="bg-apple-card rounded-xl shadow-sm border border-apple-border p-6">
                <div class="flex flex-wrap items-center gap-4">
                    <div class="flex items-center space-x-2">
                        <label class="text-sm font-medium text-gray-700">Status:</label>
                        <select id="arStatusFilter" class="px-3 py-2 border border-apple-border rounded-lg text-sm">
                            <option value="">All Status</option>
                            <option value="paid">Paid</option>
                            <option value="pending">Pending</option>
                            <option value="overdue">Overdue</option>
                        </select>
                    </div>
                    <div class="flex items-center space-x-2">
                        <label class="text-sm font-medium text-gray-700">Customer:</label>
                        <input type="text" id="arCustomerFilter" placeholder="Search customers..." class="px-3 py-2 border border-apple-border rounded-lg text-sm w-48">
                    </div>
                    <div class="flex items-center space-x-2">
                        <label class="text-sm font-medium text-gray-700">Date Range:</label>
                        <input type="date" id="arStartDate" class="px-3 py-2 border border-apple-border rounded-lg text-sm">
                        <span class="text-gray-500">to</span>
                        <input type="date" id="arEndDate" class="px-3 py-2 border border-apple-border rounded-lg text-sm">
                    </div>
                    <button id="sendRemindersBtn" class="px-4 py-2 bg-apple-orange text-white rounded-lg hover:bg-orange-600 transition-colors">
                        <i class="fas fa-bell mr-2"></i>Send Reminders
                    </button>
                </div>
            </div>

            <!-- AR Table -->
            <div class="bg-apple-card rounded-xl shadow-sm border border-apple-border overflow-hidden">
                <div class="px-6 py-4 border-b border-apple-border">
                    <h3 class="text-lg font-semibold text-gray-900">Accounts Receivable</h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-apple-border">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Invoice #</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Customer</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Due Date</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="arTableBody" class="bg-white divide-y divide-apple-border">
                            <!-- AR data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- AP Content -->
        <div id="apContent" class="space-y-6 hidden">
            <!-- AP Filters -->
            <div class="bg-apple-card rounded-xl shadow-sm border border-apple-border p-6">
                <div class="flex flex-wrap items-center gap-4">
                    <div class="flex items-center space-x-2">
                        <label class="text-sm font-medium text-gray-700">Status:</label>
                        <select id="apStatusFilter" class="px-3 py-2 border border-apple-border rounded-lg text-sm">
                            <option value="">All Status</option>
                            <option value="paid">Paid</option>
                            <option value="pending">Pending</option>
                            <option value="overdue">Overdue</option>
                        </select>
                    </div>
                    <div class="flex items-center space-x-2">
                        <label class="text-sm font-medium text-gray-700">Vendor:</label>
                        <input type="text" id="apVendorFilter" placeholder="Search vendors..." class="px-3 py-2 border border-apple-border rounded-lg text-sm w-48">
                    </div>
                    <div class="flex items-center space-x-2">
                        <label class="text-sm font-medium text-gray-700">Date Range:</label>
                        <input type="date" id="apStartDate" class="px-3 py-2 border border-apple-border rounded-lg text-sm">
                        <span class="text-gray-500">to</span>
                        <input type="date" id="apEndDate" class="px-3 py-2 border border-apple-border rounded-lg text-sm">
                    </div>
                    <button id="schedulePaymentsBtn" class="px-4 py-2 bg-apple-blue text-white rounded-lg hover:bg-blue-600 transition-colors">
                        <i class="fas fa-calendar-check mr-2"></i>Schedule Payments
                    </button>
                </div>
            </div>

            <!-- AP Table -->
            <div class="bg-apple-card rounded-xl shadow-sm border border-apple-border overflow-hidden">
                <div class="px-6 py-4 border-b border-apple-border">
                    <h3 class="text-lg font-semibold text-gray-900">Accounts Payable</h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-apple-border">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Invoice #</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Vendor</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Due Date</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="apTableBody" class="bg-white divide-y divide-apple-border">
                            <!-- AP data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Aging Report Content -->
        <div id="agingContent" class="space-y-6 hidden">
            <div class="bg-apple-card rounded-xl shadow-sm border border-apple-border p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-900">Aging Report</h3>
                    <button id="exportAgingBtn" class="px-4 py-2 border border-apple-border text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                        <i class="fas fa-download mr-2"></i>Export Report
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-apple-border">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Customer/Vendor</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Current</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">1-30 Days</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">31-60 Days</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">61-90 Days</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">90+ Days</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total</th>
                            </tr>
                        </thead>
                        <tbody id="agingTableBody" class="bg-white divide-y divide-apple-border">
                            <!-- Aging data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Invoice Modal -->
    <div id="invoiceModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 hidden">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-xl bg-apple-card">
            <div class="mt-3">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium text-gray-900">Create Invoice</h3>
                    <button id="closeInvoiceModal" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="invoiceForm">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Customer/Vendor</label>
                        <input type="text" id="invoiceCustomer" required class="w-full px-3 py-2 border border-apple-border rounded-lg focus:outline-none focus:ring-2 focus:ring-apple-blue focus:border-transparent">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Invoice Number</label>
                        <input type="text" id="invoiceNumber" required class="w-full px-3 py-2 border border-apple-border rounded-lg focus:outline-none focus:ring-2 focus:ring-apple-blue focus:border-transparent">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Date</label>
                        <input type="date" id="invoiceDate" required class="w-full px-3 py-2 border border-apple-border rounded-lg focus:outline-none focus:ring-2 focus:ring-apple-blue focus:border-transparent">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Due Date</label>
                        <input type="date" id="invoiceDueDate" required class="w-full px-3 py-2 border border-apple-border rounded-lg focus:outline-none focus:ring-2 focus:ring-apple-blue focus:border-transparent">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Amount</label>
                        <input type="number" id="invoiceAmount" step="0.01" required class="w-full px-3 py-2 border border-apple-border rounded-lg focus:outline-none focus:ring-2 focus:ring-apple-blue focus:border-transparent">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                        <textarea id="invoiceDescription" rows="3" class="w-full px-3 py-2 border border-apple-border rounded-lg focus:outline-none focus:ring-2 focus:ring-apple-blue focus:border-transparent"></textarea>
                    </div>
                    <div class="flex justify-end space-x-2">
                        <button type="button" id="cancelInvoice" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-apple-border rounded-lg hover:bg-gray-50">
                            Cancel
                        </button>
                        <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-apple-blue rounded-lg hover:bg-blue-600">
                            Create Invoice
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Record Payment Modal -->
    <div id="paymentModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 hidden">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-xl bg-apple-card">
            <div class="mt-3">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium text-gray-900">Record Payment</h3>
                    <button id="closePaymentModal" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="paymentForm">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Invoice</label>
                        <select id="paymentInvoice" required class="w-full px-3 py-2 border border-apple-border rounded-lg focus:outline-none focus:ring-2 focus:ring-apple-blue focus:border-transparent">
                            <option value="">Select Invoice</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Payment Date</label>
                        <input type="date" id="paymentDate" required class="w-full px-3 py-2 border border-apple-border rounded-lg focus:outline-none focus:ring-2 focus:ring-apple-blue focus:border-transparent">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Payment Method</label>
                        <select id="paymentMethod" required class="w-full px-3 py-2 border border-apple-border rounded-lg focus:outline-none focus:ring-2 focus:ring-apple-blue focus:border-transparent">
                            <option value="">Select Method</option>
                            <option value="check">Check</option>
                            <option value="bank_transfer">Bank Transfer</option>
                            <option value="credit_card">Credit Card</option>
                            <option value="cash">Cash</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Amount</label>
                        <input type="number" id="paymentAmount" step="0.01" required class="w-full px-3 py-2 border border-apple-border rounded-lg focus:outline-none focus:ring-2 focus:ring-apple-blue focus:border-transparent">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Reference</label>
                        <input type="text" id="paymentReference" class="w-full px-3 py-2 border border-apple-border rounded-lg focus:outline-none focus:ring-2 focus:ring-apple-blue focus:border-transparent">
                    </div>
                    <div class="flex justify-end space-x-2">
                        <button type="button" id="cancelPayment" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-apple-border rounded-lg hover:bg-gray-50">
                            Cancel
                        </button>
                        <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-apple-blue rounded-lg hover:bg-blue-600">
                            Record Payment
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="database.js"></script>
    <script src="app.js"></script>
    <script>
        class APARManagement {
            constructor() {
                this.invoices = [];
                this.payments = [];
                this.init();
            }

            async init() {
                await this.loadData();
                this.setupEventListeners();
                this.renderData();
            }

            async loadData() {
                // Mock data - would come from database
                this.invoices = [
                    {
                        id: 1,
                        invoiceNumber: 'INV-001',
                        customer: 'ABC Company',
                        date: '2024-01-15',
                        dueDate: '2024-02-15',
                        amount: 5000,
                        status: 'pending',
                        type: 'receivable'
                    },
                    {
                        id: 2,
                        invoiceNumber: 'INV-002',
                        customer: 'XYZ Corp',
                        date: '2024-01-10',
                        dueDate: '2024-02-10',
                        amount: 3500,
                        status: 'overdue',
                        type: 'receivable'
                    },
                    {
                        id: 3,
                        invoiceNumber: 'BILL-001',
                        vendor: 'Office Supplies Co',
                        date: '2024-01-20',
                        dueDate: '2024-02-20',
                        amount: 1200,
                        status: 'pending',
                        type: 'payable'
                    }
                ];
            }

            setupEventListeners() {
                // Tab switching
                document.getElementById('arTab').addEventListener('click', () => this.switchTab('ar'));
                document.getElementById('apTab').addEventListener('click', () => this.switchTab('ap'));
                document.getElementById('agingTab').addEventListener('click', () => this.switchTab('aging'));

                // Buttons
                document.getElementById('createInvoiceBtn').addEventListener('click', () => this.showInvoiceModal());
                document.getElementById('recordPaymentBtn').addEventListener('click', () => this.showPaymentModal());
                document.getElementById('sendRemindersBtn').addEventListener('click', () => this.sendReminders());
                document.getElementById('schedulePaymentsBtn').addEventListener('click', () => this.schedulePayments());

                // Modal controls
                document.getElementById('closeInvoiceModal').addEventListener('click', () => this.hideInvoiceModal());
                document.getElementById('cancelInvoice').addEventListener('click', () => this.hideInvoiceModal());
                document.getElementById('closePaymentModal').addEventListener('click', () => this.hidePaymentModal());
                document.getElementById('cancelPayment').addEventListener('click', () => this.hidePaymentModal());

                // Form submissions
                document.getElementById('invoiceForm').addEventListener('submit', (e) => this.handleInvoiceSubmit(e));
                document.getElementById('paymentForm').addEventListener('submit', (e) => this.handlePaymentSubmit(e));

                // Filters
                document.getElementById('arStatusFilter').addEventListener('change', () => this.filterAR());
                document.getElementById('apStatusFilter').addEventListener('change', () => this.filterAP());
            }

            switchTab(tab) {
                // Update tab styling
                document.querySelectorAll('nav button').forEach(btn => {
                    btn.classList.remove('border-apple-blue', 'text-apple-blue');
                    btn.classList.add('border-transparent', 'text-gray-500');
                });

                if (tab === 'ar') {
                    document.getElementById('arTab').classList.add('border-apple-blue', 'text-apple-blue');
                    document.getElementById('arTab').classList.remove('border-transparent', 'text-gray-500');
                } else if (tab === 'ap') {
                    document.getElementById('apTab').classList.add('border-apple-blue', 'text-apple-blue');
                    document.getElementById('apTab').classList.remove('border-transparent', 'text-gray-500');
                } else if (tab === 'aging') {
                    document.getElementById('agingTab').classList.add('border-apple-blue', 'text-apple-blue');
                    document.getElementById('agingTab').classList.remove('border-transparent', 'text-gray-500');
                }

                // Show/hide content
                document.getElementById('arContent').classList.toggle('hidden', tab !== 'ar');
                document.getElementById('apContent').classList.toggle('hidden', tab !== 'ap');
                document.getElementById('agingContent').classList.toggle('hidden', tab !== 'aging');

                if (tab === 'ar') this.renderAR();
                else if (tab === 'ap') this.renderAP();
                else if (tab === 'aging') this.renderAging();
            }

            renderData() {
                this.renderAR();
                this.updateSummaryCards();
            }

            renderAR() {
                const tbody = document.getElementById('arTableBody');
                tbody.innerHTML = '';

                const arInvoices = this.invoices.filter(inv => inv.type === 'receivable');
                arInvoices.forEach(invoice => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${invoice.invoiceNumber}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${invoice.customer}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${invoice.date}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${invoice.dueDate}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${this.formatCurrency(invoice.amount)}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${this.getStatusColor(invoice.status)}">
                                ${invoice.status.charAt(0).toUpperCase() + invoice.status.slice(1)}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <button onclick="aparManagement.viewInvoice(${invoice.id})" class="text-apple-blue hover:text-blue-600 mr-3">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button onclick="aparManagement.sendReminder(${invoice.id})" class="text-apple-orange hover:text-orange-600">
                                <i class="fas fa-bell"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }

            renderAP() {
                const tbody = document.getElementById('apTableBody');
                tbody.innerHTML = '';

                const apInvoices = this.invoices.filter(inv => inv.type === 'payable');
                apInvoices.forEach(invoice => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${invoice.invoiceNumber}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${invoice.vendor}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${invoice.date}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${invoice.dueDate}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${this.formatCurrency(invoice.amount)}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${this.getStatusColor(invoice.status)}">
                                ${invoice.status.charAt(0).toUpperCase() + invoice.status.slice(1)}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <button onclick="aparManagement.viewInvoice(${invoice.id})" class="text-apple-blue hover:text-blue-600 mr-3">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button onclick="aparManagement.recordPayment(${invoice.id})" class="text-apple-green hover:text-green-600">
                                <i class="fas fa-receipt"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }

            renderAging() {
                const tbody = document.getElementById('agingTableBody');
                tbody.innerHTML = '';

                // Mock aging data
                const agingData = [
                    {
                        customer: 'ABC Company',
                        current: 5000,
                        days30: 0,
                        days60: 0,
                        days90: 0,
                        days90plus: 0
                    },
                    {
                        customer: 'XYZ Corp',
                        current: 0,
                        days30: 0,
                        days60: 0,
                        days90: 3500,
                        days90plus: 0
                    }
                ];

                agingData.forEach(row => {
                    const total = row.current + row.days30 + row.days60 + row.days90 + row.days90plus;
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${row.customer}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${this.formatCurrency(row.current)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${this.formatCurrency(row.days30)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${this.formatCurrency(row.days60)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${this.formatCurrency(row.days90)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${this.formatCurrency(row.days90plus)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${this.formatCurrency(total)}</td>
                    `;
                    tbody.appendChild(tr);
                });
            }

            updateSummaryCards() {
                const receivables = this.invoices.filter(inv => inv.type === 'receivable');
                const payables = this.invoices.filter(inv => inv.type === 'payable');
                
                const totalReceivables = receivables.reduce((sum, inv) => sum + inv.amount, 0);
                const totalPayables = payables.reduce((sum, inv) => sum + inv.amount, 0);
                const overdueReceivables = receivables.filter(inv => inv.status === 'overdue')
                    .reduce((sum, inv) => sum + inv.amount, 0);

                document.getElementById('totalReceivables').textContent = this.formatCurrency(totalReceivables);
                document.getElementById('totalPayables').textContent = this.formatCurrency(totalPayables);
                document.getElementById('pastDueAmount').textContent = this.formatCurrency(overdueReceivables);
                document.getElementById('netCashFlow').textContent = this.formatCurrency(totalReceivables - totalPayables);
            }

            getStatusColor(status) {
                const colors = {
                    paid: 'bg-green-100 text-green-800',
                    pending: 'bg-yellow-100 text-yellow-800',
                    overdue: 'bg-red-100 text-red-800'
                };
                return colors[status] || 'bg-gray-100 text-gray-800';
            }

            showInvoiceModal() {
                document.getElementById('invoiceModal').classList.remove('hidden');
            }

            hideInvoiceModal() {
                document.getElementById('invoiceModal').classList.add('hidden');
                document.getElementById('invoiceForm').reset();
            }

            showPaymentModal() {
                document.getElementById('paymentModal').classList.remove('hidden');
                this.populatePaymentInvoices();
            }

            hidePaymentModal() {
                document.getElementById('paymentModal').classList.add('hidden');
                document.getElementById('paymentForm').reset();
            }

            populatePaymentInvoices() {
                const select = document.getElementById('paymentInvoice');
                select.innerHTML = '<option value="">Select Invoice</option>';
                
                this.invoices.forEach(invoice => {
                    const option = document.createElement('option');
                    option.value = invoice.id;
                    option.textContent = `${invoice.invoiceNumber} - ${invoice.customer || invoice.vendor} (${this.formatCurrency(invoice.amount)})`;
                    select.appendChild(option);
                });
            }

            async handleInvoiceSubmit(e) {
                e.preventDefault();
                const formData = {
                    invoiceNumber: document.getElementById('invoiceNumber').value,
                    customer: document.getElementById('invoiceCustomer').value,
                    date: document.getElementById('invoiceDate').value,
                    dueDate: document.getElementById('invoiceDueDate').value,
                    amount: parseFloat(document.getElementById('invoiceAmount').value),
                    description: document.getElementById('invoiceDescription').value,
                    type: 'receivable'
                };

                // Add to invoices array
                this.invoices.push({
                    id: this.invoices.length + 1,
                    ...formData,
                    status: 'pending'
                });

                this.hideInvoiceModal();
                this.renderData();
                alert('Invoice created successfully!');
            }

            async handlePaymentSubmit(e) {
                e.preventDefault();
                const formData = {
                    invoiceId: document.getElementById('paymentInvoice').value,
                    date: document.getElementById('paymentDate').value,
                    method: document.getElementById('paymentMethod').value,
                    amount: parseFloat(document.getElementById('paymentAmount').value),
                    reference: document.getElementById('paymentReference').value
                };

                // Update invoice status
                const invoice = this.invoices.find(inv => inv.id == formData.invoiceId);
                if (invoice) {
                    invoice.status = 'paid';
                }

                this.hidePaymentModal();
                this.renderData();
                alert('Payment recorded successfully!');
            }

            sendReminders() {
                const overdueInvoices = this.invoices.filter(inv => inv.status === 'overdue');
                alert(`Sending reminders for ${overdueInvoices.length} overdue invoices`);
            }

            schedulePayments() {
                const pendingPayables = this.invoices.filter(inv => inv.type === 'payable' && inv.status === 'pending');
                alert(`Scheduling payments for ${pendingPayables.length} pending bills`);
            }

            viewInvoice(id) {
                const invoice = this.invoices.find(inv => inv.id === id);
                if (invoice) {
                    alert(`Viewing invoice ${invoice.invoiceNumber}`);
                }
            }

            sendReminder(id) {
                const invoice = this.invoices.find(inv => inv.id === id);
                if (invoice) {
                    alert(`Sending reminder for invoice ${invoice.invoiceNumber}`);
                }
            }

            recordPayment(id) {
                const invoice = this.invoices.find(inv => inv.id === id);
                if (invoice) {
                    document.getElementById('paymentInvoice').value = id;
                    this.showPaymentModal();
                }
            }

            filterAR() {
                // Implement AR filtering
            }

            filterAP() {
                // Implement AP filtering
            }

            formatCurrency(amount) {
                return new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: 'USD'
                }).format(amount);
            }
        }

        // Initialize when page loads
        let aparManagement;
        document.addEventListener('DOMContentLoaded', function() {
            aparManagement = new APARManagement();
        });
    </script>
</body>
</html> 